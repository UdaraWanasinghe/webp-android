[![android library](https://img.shields.io/badge/version-v1.0.0-orange)](https://github.com/UdaraWanasinghe/webp-android)



## What's Included?

✅ Encode a series of android bitmap images to an animated WebP image.



## TODO

⬜ Extract images from an animated WebP image.

⬜ Add unit test cases.



## Building

1. Clone libwebp library and checkout to version `1.2.4`
   ```shell
   git clone https://chromium.googlesource.com/webm/libwebp
   cd libwebp
   git checkout v1.2.4
   cd ..
   ```
2. Clone this repository.

   ```shell
   git clone https://github.com/UdaraWanasinghe/webp-android.git
   cd webp-android
   ```

3. Add `local.properties` file and define the android sdk location. (`local.properties` file is automatically generated by android studio.)

   ```properties
   # local.properties
   sdk.dir=/home/udara/Android/Sdk
   ```

4. Run `gradle` task `publishToMavenLocal` in webp-android project.
   ```shell
   cd webp-android
   sh gradlew publishToMavenLocal
   ```

Note that libwebp project should be in the same directory as webp-android project.

At this point our library should be in the maven local repository.



## Using

1. Include the `mavenLocal` repository in your project.

   ```groovy
   // settings.gradle
   dependencyResolutionManagement {
       ...
       repositories {
           ...
           mavenLocal()
       }
   }
   ```

2. Import the library into your project.

   ```groovy
   // module level build.gradle
   dependencies {
       implementation "com.aureusapps.android:webp-android:1.0.0"
   }
   ```

3. Create an encoder instance.

   ```kotlin
   val encoder = WebPAnimEncoder(
       width = 512,
       height = 512,
       WebPAnimEncoderOptions(
           animParams = WebPMuxAnimParams(loopCount = 0)
       )
   )
   ```

   See full list of encoder options [here](webp-android/src/main/java/com/aureusapps/android/webpandroid/encoder/WebPAnimEncoderOptions.kt).

4. Configure the encoder.

   ```kotlin
   encoder.configure(
       WebPConfig(
           lossless = WebPConfig.COMPRESSION_LOSSLESS,
           quality = 100f
       )
   )
   ```

   See full list of encoder configurations [here](webp-android/src/main/java/com/aureusapps/android/webpandroid/encoder/WebPConfig.kt).

5. Add encoder progress listener.

   ```kotlin
   encoder.addProgressListener(object : WebPAnimEncoderListener {
       override fun onProgressUpdate(framePercent: Int, currentFrame: Int) {
           // update progress here
       }
   })
   ```

6. Add frames with their timestamp.

   ```kotlin
   encoder.addFrame(WebPFrame(bitmap1, 0))
   encoder.addFrame(WebPFrame(bitmap2, 1000))
   ```

7. Call assemble by giving the last timestamp and the save path.

   ```kotlin
   encoder.assemble(2000, path)
   ```

8. Release the encoder resources.

   ```kotlin
   encoder.release()
   ```



## Appreciate my work!

<a href="https://www.buymeacoffee.com/udarawanasinghe" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/default-orange.png" alt="Buy Me A Coffee" height="41" width="174"></a>